import React from 'react';
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import { Umbrella, Thermometer, Home, GraduationCap } from 'lucide-react';

const LEAVE_CONFIG = {
  annual: { icon: Umbrella, color: 'text-blue-500', bg: 'bg-blue-500', label: 'Annual Leave' },
  sick: { icon: Thermometer, color: 'text-red-500', bg: 'bg-red-500', label: 'Sick Leave' },
  family_responsibility: { icon: Home, color: 'text-purple-500', bg: 'bg-purple-500', label: 'Family Leave' },
  study: { icon: GraduationCap, color: 'text-amber-500', bg: 'bg-amber-500', label: 'Study Leave' }
};

export default function LeaveBalanceCard({ employee, leaveRequests }) {
  const currentYear = new Date().getFullYear();
  
  const approvedThisYear = leaveRequests.filter(r => 
    r.status === 'approved' && 
    r.employee_id === employee?.employee_id &&
    new Date(r.start_date).getFullYear() === currentYear
  );

  const getUsedDays = (type) => {
    return approvedThisYear
      .filter(r => r.leave_type === type)
      .reduce((sum, r) => sum + (r.total_days || 0), 0);
  };

  const balances = [
    { 
      type: 'annual', 
      total: employee?.annual_leave_balance || 21, 
      used: getUsedDays('annual')
    },
    { 
      type: 'sick', 
      total: employee?.sick_leave_balance || 30, 
      used: getUsedDays('sick')
    },
    { 
      type: 'family_responsibility', 
      total: 3, 
      used: getUsedDays('family_responsibility')
    },
    { 
      type: 'study', 
      total: 5, 
      used: getUsedDays('study')
    }
  ];

  return (
    <Card className="border-0 shadow-sm">
      <CardHeader className="pb-2">
        <CardTitle className="text-lg">Leave Balances</CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        {balances.map(balance => {
          const config = LEAVE_CONFIG[balance.type];
          const Icon = config.icon;
          const remaining = balance.total - balance.used;
          const percentage = (balance.used / balance.total) * 100;

          return (
            <div key={balance.type} className="space-y-2">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-2">
                  <Icon className={`w-4 h-4 ${config.color}`} />
                  <span className="text-sm font-medium text-slate-700">{config.label}</span>
                </div>
                <span className="text-sm text-slate-600">
                  <span className="font-semibold">{remaining}</span>
                  <span className="text-slate-400">/{balance.total} days</span>
                </span>
              </div>
              <Progress value={percentage} className="h-2" />
              <div className="flex justify-between text-xs text-slate-400">
                <span>Used: {balance.used} days</span>
                <span>Available: {remaining} days</span>
              </div>
            </div>
          );
        })}
      </CardContent>
    </Card>
  );
}
